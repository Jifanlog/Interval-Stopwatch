<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Countdown Timers</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background-color: #f4f4f4;
        }
        .timer {
            font-size: 2em;
            margin-bottom: 10px;
            transition: opacity 1s ease-out;
        }
        .fade-out {
            opacity: 0;
        }
        button, input {
            font-size: 1em;
            padding: 10px;
            margin: 5px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <label>
        Prevent Screen Sleep:
        <input type="checkbox" id="wakeLockToggle">
    </label>
    <div>
        <label for="inputMinutes">Minutes:</label>
        <input type="number" id="inputMinutes" min="0" style="width: 50px;">
        <label for="inputSeconds">Seconds:</label>
        <input type="number" id="inputSeconds" min="0" max="59" oninput="validateSeconds(this)" style="width: 50px;">
        <button id="addTimer">Add Timer</button>
    </div>
    <div id="timers"></div>
    <button id="start">Start</button>
    <button id="stop">Stop</button>
    <button id="reset">Reset</button>

    <script>
        let timers = [];
        let timerIntervals = [];
        let running = false;
        let wakeLock = null;
        let wakeLockEnabled = false;

        async function requestWakeLock() {
            if ('wakeLock' in navigator && wakeLockEnabled) {
                try {
                    wakeLock = await navigator.wakeLock.request('screen');
                    console.log('Wake Lock is active');
                } catch (err) {
                    console.error('Wake Lock request failed:', err);
                }
            }
        }

        function releaseWakeLock() {
            if (wakeLock !== null) {
                wakeLock.release().then(() => {
                    wakeLock = null;
                    console.log('Wake Lock released');
                });
            }
        }

        document.getElementById("wakeLockToggle").addEventListener("change", function() {
            wakeLockEnabled = this.checked;
            if (!wakeLockEnabled) {
                releaseWakeLock();
            }
        });

        function validateSeconds(input) {
            if (input.value > 59) {
                input.value = 59;
            } else if (input.value < 0) {
                input.value = 0;
            }
        }

        function addTimer() {
            const minutes = parseInt(document.getElementById("inputMinutes").value) || 0;
            const seconds = parseInt(document.getElementById("inputSeconds").value) || 0;
            if (minutes === 0 && seconds === 0) return;
            const timerId = timers.length;
            timers.push({ minutes, seconds, milliseconds: 0 });
            const timerDiv = document.createElement("div");
            timerDiv.className = "timer";
            timerDiv.id = `timer${timerId}`;
            timerDiv.innerHTML = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}:000`;
            document.getElementById("timers").appendChild(timerDiv);
        }

        function updateDisplay(timerId) {
            const timer = timers[timerId];
            document.getElementById(`timer${timerId}`).textContent = 
                `${String(timer.minutes).padStart(2, '0')}:${String(timer.seconds).padStart(2, '0')}:${String(timer.milliseconds).padStart(3, '0')}`;
        }

        function startTimer(index = 0) {
            if (index >= timers.length) return;
            if (!running) {
                running = true;
            }

            const timer = timers[index];
            timerIntervals[index] = setInterval(() => {
                if (timer.milliseconds === 0) {
                    if (timer.seconds === 0) {
                        if (timer.minutes === 0) {
                            clearInterval(timerIntervals[index]);
                            fadeOutTimer(index);
                            startTimer(index + 1);
                            return;
                        } else {
                            timer.minutes--;
                            timer.seconds = 59;
                            timer.milliseconds = 990;
                        }
                    } else {
                        timer.seconds--;
                        timer.milliseconds = 990;
                    }
                } else {
                    timer.milliseconds -= 10;
                }
                updateDisplay(index);
            }, 10);
        }

        function fadeOutTimer(index) {
            const timerElement = document.getElementById(`timer${index}`);
            if (timerElement) {
                timerElement.classList.add("fade-out");
                setTimeout(() => {
                    timerElement.remove();
                }, 1000);
            }
        }

        function stopTimers() {
            running = false;
            timerIntervals.forEach(clearInterval);
        }

        function resetTimers() {
            stopTimers();
            document.getElementById("timers").innerHTML = "";
            timers = [];
            timerIntervals = [];
        }

        document.getElementById("addTimer").addEventListener("click", addTimer);
        document.getElementById("start").addEventListener("click", () => {
            if (wakeLockEnabled) requestWakeLock();
            startTimer(0);
        });
        document.getElementById("stop").addEventListener("click", () => {
            stopTimers();
            releaseWakeLock();
        });
        document.getElementById("reset").addEventListener("click", () => {
            resetTimers();
            releaseWakeLock();
        });
    </script>
</body>
</html>
